<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar bg-body-tertiary mb-5">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/image/cash-coin.svg?v=<%= Date.now() %>" alt="Stock Watchy" width="30" height="30" class="d-inline-block align-text-top">
                <small class="ps-2"> Stock Watchy </small>
            </a>
            <form class="d-flex" role="search" action="/watchlist/ticker-added" method="POST">
                <input class="form-control me-2" name="tickerInput" type="search" placeholder="Ticker" aria-label="Search">
                <input type="hidden" name="authName" value="<%= authName %>"> <!-- Include the username -->
                <button class="btn btn-outline-success w-75" type="submit">Add Stock</button>
            </form>

        </div>
    </nav>

    <% console.log(locals.dataBase.get(authName).stockData.length); %>
    <% if(locals.dataBase.get(authName).stockData.length === 0) { %>
      <div id="welcomeToast" class="toast mb-3 w-50 container" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <img src="./image/cash-coin.svg" class="rounded me-2" alt="...">
          <strong class="me-auto">Stock Wathcy</strong>
          <small>1 seconds ago</small>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" style="text-align: center">
          Welcome to Stock Watchy. Add stocks to watchlist by providing stock ticker on top right corner box of the page
        </div>
      </div>
    <% } %>
    
    
    
    <div class="container">
        <div class="row row-cols-1 row-cols-lg-3 align-items-stretch g-5">
            <% const stocks= locals.dataBase.get(authName).stockData; %>
            <% stocks.forEach(stock => { %>
                <div class="col">
                    <div class="card card-cover h-100 overflow-hidden text-bg-dark rounded-4 shadow-lg" style="background-image: url('<%= stock.image %>');">
                        <div class="d-flex flex-column h-100 p-5 pb-3 text-white text-shadow-1 ">
                            <h3 class="mb-4 display-6 lh-1 fw-bold"><%= stock.symbol %></h3>
                            <!-- TradingView Widget BEGIN -->
                            <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget" style="height: 400px; width: 100%;"></div>
                                <div class="tradingview-widget-copyright">
                                    <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                                        <span class="blue-text">Track all markets on TradingView</span>
                                    </a>
                                </div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js" async>
                                {
                                    "symbols": [["<%= stock.symbol %>", "<%= stock.ticker %>"]],
                                    "chartOnly": false,
                                    "width": "100%",
                                    "height": "400",
                                    "locale": "en",
                                    "colorTheme": "dark",
                                    "autosize": false,
                                    "showVolume": false,
                                    "showMA": false,
                                    "hideDateRanges": false,
                                    "hideMarketStatus": false,
                                    "hideSymbolLogo": false,
                                    "scalePosition": "right",
                                    "scaleMode": "Normal",
                                    "fontFamily": "-apple-system, BlinkMacSystemFont, Trebuchet MS, Roboto, Ubuntu, sans-serif",
                                    "fontSize": "10",
                                    "noTimeScale": false,
                                    "valuesTracking": "1",
                                    "changeMode": "price-and-percent",
                                    "chartType": "area",
                                    "maLineColor": "#2962FF",
                                    "maLineWidth": 1,
                                    "maLength": 9,
                                    "lineWidth": 2,
                                    "lineType": 0,
                                    "dateRanges": ["1d|1", "1m|30", "3m|60", "12m|1D", "60m|1W", "all|1M"]
                                }
                                </script>
                            </div>
                            <!-- TradingView Widget END -->
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>


    
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            var toastEl = document.getElementById('welcomeToast');
            if (toastEl) {
                var toast = new bootstrap.Toast(toastEl);
                toast.show();
            }
        });
    </script>
</body>
</html>